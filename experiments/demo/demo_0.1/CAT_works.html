<!DOCTYPE html>
<html>
  <head>
    <title>CAT TEST</title>
    <script src="jspsych-6.1.0/jspsych.js"></script>
    <script src="jspsych-6.1.0/plugins/jspsych-html-keyboard-response.js"></script>
	<script src="jspsych-6.1.0/plugins/jspsych-image-keyboard-response.js"></script>
	<script src="jspsych-6.1.0/plugins/jspsych-fullscreen.js"></script>
    <script src="jspsych-6.1.0/plugins/jspsych-visual-search-circle.js"></script>
    <script src="jspsych-6.1.0/plugins/jspsych-vsl-animate-occlusion.js"></script>
	<script src="jspsych-6.1.0/plugins/jspsych-survey-text.js"></script>
    <script src="jspsych-6.1.0/plugins/jspsych-html-button-response.js"></script>
    <script src="jspsych-6.1.0/plugins/jspsych-image-button-response.js"></script>
	
    <link href="jspsych-6.1.0/css/jspsych.css" rel="stylesheet" type="text/css"></link>
	<style>
		body {background-color: White;}
		</style>
  </head>
  <body>
	      <div id="jspsych-target"></div>
  </body>
	
  <script>

    /* create timeline */
    var timeline = [];
	
	/* enter fullscreen mode */
	/*timeline.push({
	  type: 'fullscreen',
	  fullscreen_mode: true
	});*/
	
	var maleArray = ['20','21','22','23','25','26','27','28','29','30','31'];
	var shuffledMale = jsPsych.randomization.shuffle(maleArray);
	var maleOne = shuffledMale[0];
	var maleTwo = shuffledMale[1];
	var maleThree = shuffledMale[2];
	
	
	var femaleArray = ['01','02','03','05','06','07','08','09','10','13','17'];
	var shuffledFemale = jsPsych.randomization.shuffle(femaleArray);
	var femaleOne = shuffledFemale[0];
	var femaleTwo = shuffledFemale[1];
	var femaleThree = shuffledFemale[2];
	
	var morph = ['20', '25', '30', '35', '40', '45', '55', '60', '65', '70', '75', '80'];
	
	
	
	var emotionArray = ['angry'];
	var shuffledEmotion = jsPsych.randomization.shuffle(emotionArray);
	var emotion = shuffledEmotion[0];

	/* instructions */
	var instructions = {
	    type: 'html-keyboard-response',
	    stimulus: "<p style='font-size: 36px'>Instrusctions</p><p style='font-size: 36px'>More Instructions</p>",
		choices: jsPsych.ALL_KEYS,
	  	response_ends_trial: true
	};
    timeline.push(instructions);
	
	
	/*assessment block 1*/
	var test = {
		timeline: [

			{
				type: 'image-button-response',
	      	  	stimulus: jsPsych.timelineVariable('image'),
	      	  	choices: ['left', 'right'],
				margin_horizontal: '150px',
				response_ends_trial: true, 
				data: {
					stimulus_type: [jsPsych.timelineVariable('stimulus_type')],
					corr_resp: [jsPsych.timelineVariable('corr_resp')],
					percent: [jsPsych.timelineVariable('percent')],
					block: 'assessment'
					  },
		        button_html: [
		            '<img src="cat_images/redRoom.JPG" height="219px" width="219px"/>',
					'<img src="cat_images/blueRoom.JPG" height="219px" width="219px"/>'
		        ],
				on_finish: function(data){
				    if(data.button_pressed == data.corr_resp){// 0 is left
				      data.correct = true; // can add property correct by modify data object directly
				    } else {
				      data.correct = false;
				    }


				  }
			},
			
		],
		timeline_variables: [
			{image: ['cat_images/20'+emotion+femaleOne+'.JPG'], 
			stimulus_type: "calm",
			corr_resp: 1,
			percent: '20',
			},
			{image: ['cat_images/25'+emotion+'01.JPG'], 
			stimulus_type: "calm",
			corr_resp: 1,
			percent: '25',
			},
			{image: ['cat_images/30'+emotion+'01.JPG'], 
			stimulus_type: "calm",
			corr_resp: 1,
			percent: '30',
			},
			{image: ['cat_images/35'+emotion+'01.JPG'], 
			stimulus_type: "calm",
			corr_resp: 1,
			percent: '35',
			},
			{image: ['cat_images/40'+emotion+'01.JPG'], 
			stimulus_type: "calm",
			corr_resp: 1,
			percent: '40',
			},
			{image: ['cat_images/45'+emotion+'01.JPG'], 
			stimulus_type: "calm",
			corr_resp: 1,
			percent: '45',
			},
			{image: ['cat_images/55'+emotion+'01.JPG'], 
			stimulus_type: "emotion",
			corr_resp: 0,
			percent: '55',
			},
			{image: ['cat_images/60'+emotion+'01.JPG'], 
			stimulus_type: "emotion",
			corr_resp: 0,
			percent: '60',
			},
			{image: ['cat_images/65'+emotion+'01.JPG'], 
			stimulus_type: "emotion",
			corr_resp: 0,
			percent: '65',
			},
			{image: ['cat_images/70'+emotion+'01.JPG'], 
			stimulus_type: "emotion",
			corr_resp: 0,
			percent: '70',
			},
			{image: ['cat_images/75'+emotion+'01.JPG'], 
			stimulus_type: "emotion",
			corr_resp: 0,
			percent: '75',
			},
			{image: ['cat_images/80'+emotion+'01.JPG'], 
			stimulus_type: "emotion",
			corr_resp: 0,
			percent: '80',
			},
		],
		sample: {
		        type: 'fixed-repetitions',
		        size: 1, // 3 repetitions of each trial, 12 total trials, order is randomized.
		    }
	};
    timeline.push(test);
	
	/* instructions */
	var instructions_sup = {
	    type: 'html-keyboard-response',
	    stimulus: "<p style='font-size: 36px'>You will play again.</p><p style='font-size: 36px'>This time we will give you feedback.</p>",
		choices: jsPsych.ALL_KEYS,
	  	response_ends_trial: true
	};
    timeline.push(instructions_sup);
	
	/*training block 1*/
	var train = {
		timeline: [

			{
				type: 'image-button-response',
	      	  	stimulus: jsPsych.timelineVariable('image'),
	      	  	choices: ['left', 'right'],
				margin_horizontal: '150px',
				response_ends_trial: true, 
				data: {
					stimulus_type: [jsPsych.timelineVariable('stimulus_type')],
					corr_resp: [jsPsych.timelineVariable('corr_resp')],
					block: 'assessment'
					  },
		        button_html: [
		            '<img src="cat_images/redRoom.JPG" height="219px" width="219px"/>',
					'<img src="cat_images/blueRoom.JPG" height="219px" width="219px"/>'
		        ],
				on_finish: function(data){
				    if(data.button_pressed == data.corr_resp){// 0 is left
				      data.correct = true; // can add property correct by modify data object directly
				    } else {
				      data.correct = false;
				    }

				  }
			},
			
			{
			  type: 'html-keyboard-response',
			  trial_duration: 800,
			  stimulus: function(){
			    var last_trial_correct = jsPsych.data.get().last(1).values()[0].correct;
			    if(last_trial_correct){
			      return "<p>Correct!</p>";
			    } else {
			      return "<p>Incorrect.</p>"
			    }
			  }
			},
			
		],
		timeline_variables: [
		{image: ['cat_images/20angry01.JPG'], 
		stimulus_type: "calm",
		corr_resp: 1,
		},
		{image: ['cat_images/25angry01.JPG'], 
		stimulus_type: "calm",
		corr_resp: 1,
		},
		{image: ['cat_images/30angry01.JPG'], 
		stimulus_type: "calm",
		corr_resp: 1,
		},
		{image: ['cat_images/35angry01.JPG'], 
		stimulus_type: "calm",
		corr_resp: 1,
		},
		{image: ['cat_images/40angry01.JPG'], 
		stimulus_type: "calm",
		corr_resp: 1,
		},
		{image: ['cat_images/45angry01.JPG'], 
		stimulus_type: "calm",
		corr_resp: 1,
		},
		{image: ['cat_images/55angry01.JPG'], 
		stimulus_type: "emotion",
		corr_resp: 0,
		},
		{image: ['cat_images/60angry01.JPG'], 
		stimulus_type: "emotion",
		corr_resp: 0,
		},
		{image: ['cat_images/65angry01.JPG'], 
		stimulus_type: "emotion",
		corr_resp: 0,
		},
		{image: ['cat_images/70angry01.JPG'], 
		stimulus_type: "emotion",
		corr_resp: 0,
		},
		{image: ['cat_images/75angry01.JPG'], 
		stimulus_type: "emotion",
		corr_resp: 0,
		},
		{image: ['cat_images/80angry01.JPG'], 
		stimulus_type: "emotion",
		corr_resp: 0,
		},
		],
		sample: {
		        type: 'fixed-repetitions',
		        size: 1, // 3 repetitions of each trial, 12 total trials, order is randomized.
		    }
	};
    timeline.push(train);
	
	

	
	/* All Done */
	var done = {
	    type: 'html-keyboard-response',
	    stimulus: "<p style='font-size: 36px'>You are all done!</p><p style='font-size: 36px'>Thank you!</p>",
		choices: jsPsych.ALL_KEYS,
	  	response_ends_trial: true
	};
    timeline.push(done);
	
	// exit fullscreen mode
	/*timeline.push({
	  type: 'fullscreen',
	  fullscreen_mode: false
	});

	
    /* start the experiment */
    jsPsych.init({
	  timeline: timeline,
	  //preload_images: images,
	  exclusions: {
	      min_width: 800,
	      min_height: 600
	    },
	   on_close: function(){
		      var data = jsPsych.data.get().json();
		      save_data_to_server(data);
		    },
       on_finish: function() {
        jsPsych.data.addProperties({
			//id: id,
			//condition: conditionName
        });
        jsPsych.data.get().localSave('csv','CAT-test.csv');
      }
    });
	
	


  </script>
</html>